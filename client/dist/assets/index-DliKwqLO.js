const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-DnFq5L_g.js","assets/vendor-D2owFAG-.js","assets/vendor-DBkz-poX.css","assets/vendor-visuals-gZFlGGSH.js","assets/Register-CBFjNr2N.js","assets/Dashboard-BFZ4UF0b.js","assets/Estimate-COk65ndC.js","assets/Result-ZUMVstL0.js","assets/Profile-BewpV4Up.js","assets/Admin-DGN0hcng.js"])))=>i.map(i=>d[i]);
import{r as l,a as S,j as e,u as k,L as x,N as b,R as L,B as A,b as C,c as f,d as I}from"./vendor-D2owFAG-.js";import{N as O,T as D}from"./vendor-visuals-gZFlGGSH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const T="modulepreload",z=function(o){return"/"+o},R={},j=function(t,s,i){let r=Promise.resolve();if(s&&s.length>0){let N=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),n=d?.nonce||d?.getAttribute("nonce");r=N(s.map(u=>{if(u=z(u),u in R)return;R[u]=!0;const h=u.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":T,h||(c.as="script"),c.crossOrigin="",c.href=u,n&&c.setAttribute("nonce",n),document.head.appendChild(c),h)return new Promise((m,g)=>{c.addEventListener("load",m),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(d){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=d,window.dispatchEvent(n),!n.defaultPrevented)throw d}return r.then(d=>{for(const n of d||[])n.status==="rejected"&&a(n.reason);return t().catch(a)})},P=l.createContext(),_=()=>l.useContext(P),V=({children:o})=>{const[t,s]=l.useState(null),[i,r]=l.useState(localStorage.getItem("token")),[a,d]=l.useState(!0),n=S.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});i&&(n.defaults.headers.common.Authorization=`Bearer ${i}`);const N=()=>{localStorage.removeItem("token"),r(null),s(null),n.defaults.headers.common.Authorization&&delete n.defaults.headers.common.Authorization};l.useEffect(()=>{(async()=>{if(i)try{const m=await n.get("/auth/me");s(m.data)}catch(m){console.error("Auth check failed",m),N()}d(!1)})()},[i,n]);const u=async(c,m)=>{const g=await n.post("/auth/login",{email:c,password:m}),{access_token:E,user:v}=g.data;return localStorage.setItem("token",E),r(E),s(v),v},h=async(c,m,g)=>{const E=await n.post("/auth/register",{username:c,email:m,password:g}),{access_token:v,user:w}=E.data;return localStorage.setItem("token",v),r(v),s(w),w},p=async c=>{const m=await n.put("/auth/update",c);return s(m.data.user),m.data};return e.jsx(P.Provider,{value:{user:t,token:i,login:u,register:h,logout:N,updateProfile:p,loading:a,api:n},children:o})},U=()=>{const{user:o,logout:t}=_(),s=k(),i=()=>{t(),s("/login")};return e.jsx("nav",{className:"navbar navbar-expand-lg navbar-dark shadow-sm",children:e.jsxs("div",{className:"container",children:[e.jsx(x,{className:"navbar-brand fw-bold text-uppercase",to:"/",children:"Civil Estimator"}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"navbarNav",children:e.jsx("ul",{className:"navbar-nav ms-auto",children:o?e.jsxs(e.Fragment,{children:[e.jsx("li",{className:"nav-item",children:e.jsx(x,{className:"nav-link",to:"/dashboard",children:"Dashboard"})}),e.jsx("li",{className:"nav-item",children:e.jsx(x,{className:"nav-link",to:"/estimate",children:"New Estimate"})}),o.is_admin&&e.jsx("li",{className:"nav-item",children:e.jsx(x,{className:"nav-link text-warning",to:"/admin",children:"Admin"})}),e.jsxs("li",{className:"nav-item dropdown",children:[e.jsx("a",{className:"nav-link dropdown-toggle",href:"#",role:"button","data-bs-toggle":"dropdown",children:o.username}),e.jsxs("ul",{className:"dropdown-menu dropdown-menu-end",children:[e.jsx("li",{children:e.jsx(x,{className:"dropdown-item",to:"/profile",children:"Profile"})}),e.jsx("li",{children:e.jsx("hr",{className:"dropdown-divider"})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item text-danger",onClick:i,children:"Logout"})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{className:"nav-item",children:e.jsx(x,{className:"nav-link",to:"/login",children:"Login"})}),e.jsx("li",{className:"nav-item",children:e.jsx(x,{className:"nav-link",to:"/register",children:"Register"})})]})})})]})})},y=({children:o,adminOnly:t=!1})=>{const{user:s,loading:i}=_();return i?e.jsx("div",{children:"Loading..."}):s?t&&!s.is_admin?e.jsx(b,{to:"/dashboard"}):o:e.jsx(b,{to:"/login"})};class B extends L.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#fff",height:"100vh",overflow:"auto"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}const F=({children:o})=>{const[t,s]=l.useState(null),i=l.useRef(null);return l.useEffect(()=>((()=>{if(!t&&i.current)try{s(O({el:i.current,THREE:D,mouseControls:!0,touchControls:!0,gyroControls:!1,minHeight:200,minWidth:200,scale:1,scaleMobile:1,color:4149685,backgroundColor:988970,points:12,maxDistance:22,spacing:18}))}catch(a){console.error("[Vanta] Failed to initialize:",a)}})(),()=>{t&&t.destroy()}),[t]),e.jsx("div",{ref:i,style:{minHeight:"100vh",width:"100%",position:"relative"},children:e.jsx("div",{style:{position:"relative",zIndex:1},children:o})})},M=l.lazy(()=>j(()=>import("./Login-DnFq5L_g.js"),__vite__mapDeps([0,1,2,3]))),$=l.lazy(()=>j(()=>import("./Register-CBFjNr2N.js"),__vite__mapDeps([4,1,2,3]))),q=l.lazy(()=>j(()=>import("./Dashboard-BFZ4UF0b.js"),__vite__mapDeps([5,1,2,3]))),H=l.lazy(()=>j(()=>import("./Estimate-COk65ndC.js"),__vite__mapDeps([6,1,2,3]))),W=l.lazy(()=>j(()=>import("./Result-ZUMVstL0.js"),__vite__mapDeps([7,1,2,3]))),K=l.lazy(()=>j(()=>import("./Profile-BewpV4Up.js"),__vite__mapDeps([8,1,2,3]))),G=l.lazy(()=>j(()=>import("./Admin-DGN0hcng.js"),__vite__mapDeps([9,1,2,3])));function J(){const{user:o,loading:t}=_();return t?e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx("div",{className:"spinner-border text-primary",role:"status"})}):e.jsx(A,{children:e.jsxs(F,{children:[e.jsx(U,{}),e.jsx("div",{className:"container mt-4 min-vh-100",children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx("div",{className:"spinner-border text-primary"})}),children:e.jsxs(C,{children:[e.jsx(f,{path:"/login",element:o?e.jsx(b,{to:"/dashboard"}):e.jsx(M,{})}),e.jsx(f,{path:"/register",element:o?e.jsx(b,{to:"/dashboard"}):e.jsx($,{})}),e.jsx(f,{path:"/dashboard",element:e.jsx(y,{children:e.jsx(q,{})})}),e.jsx(f,{path:"/estimate",element:e.jsx(y,{children:e.jsx(H,{})})}),e.jsx(f,{path:"/result/:id",element:e.jsx(y,{children:e.jsx(W,{})})}),e.jsx(f,{path:"/profile",element:e.jsx(y,{children:e.jsx(K,{})})}),e.jsx(f,{path:"/admin",element:e.jsx(y,{adminOnly:!0,children:e.jsx(G,{})})}),e.jsx(f,{path:"*",element:e.jsx(b,{to:o?"/dashboard":"/login"})})]})})})]})})}I.createRoot(document.getElementById("root")).render(e.jsx(L.StrictMode,{children:e.jsx(B,{children:e.jsx(V,{children:e.jsx(J,{})})})}));export{_ as u};
